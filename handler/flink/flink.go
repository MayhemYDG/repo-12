// Code generated by Aiven. DO NOT EDIT.

package flink

import (
	"context"
	"encoding/json"
	"fmt"
)

type Handler interface {
	// Overview get a cluster overview
	// ServiceFlinkOverview GET /project/{project}/service/{service_name}/flink/overview
	// https://api.aiven.io/doc/#tag/Service:_Flink/operation/ServiceFlinkOverview
	Overview(ctx context.Context, project string, serviceName string) (*OverviewOut, error)
}

func NewHandler(doer doer) Handler {
	return &handler{doer}
}

type doer interface {
	Do(ctx context.Context, operationID, method, path string, v any) ([]byte, error)
}

type handler struct {
	doer doer
}

func (h *handler) Overview(ctx context.Context, project string, serviceName string) (*OverviewOut, error) {
	path := fmt.Sprintf("/project/%s/service/%s/flink/overview", project, serviceName)
	b, err := h.doer.Do(ctx, "ServiceFlinkOverview", "GET", path, nil)
	out := new(OverviewOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return out, nil
}

type OverviewOut struct {
	FlinkCommit    string `json:"flink-commit,omitempty"`
	FlinkVersion   string `json:"flink-version,omitempty"`
	JobsCancelled  *int   `json:"jobs-cancelled,omitempty"`
	JobsFailed     *int   `json:"jobs-failed,omitempty"`
	JobsFinished   *int   `json:"jobs-finished,omitempty"`
	JobsRunning    *int   `json:"jobs-running,omitempty"`
	SlotsAvailable *int   `json:"slots-available,omitempty"`
	SlotsTotal     *int   `json:"slots-total,omitempty"`
	Taskmanagers   *int   `json:"taskmanagers,omitempty"`
}
